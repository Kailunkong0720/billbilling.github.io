<!DOCTYPE html>

<!--
 // WEBSITE: https://themefisher.com
 // TWITTER: https://twitter.com/themefisher
 // FACEBOOK: https://www.facebook.com/themefisher
 // GITHUB: https://github.com/themefisher/
-->

<html lang="en" dir="ltr">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>多多益善</title>
    
  <!-- theme meta -->
  <meta name="theme-name" content="mono" />

  <!-- GOOGLE FONTS -->
  <link href="https://fonts.googleapis.com/css?family=Karla:400,700|Roboto" rel="stylesheet">
  <link href="plugins/material/css/materialdesignicons.min.css" rel="stylesheet" />
  <link href="plugins/simplebar/simplebar.css" rel="stylesheet" />

  <!-- PLUGINS CSS STYLE -->
  <link href="plugins/nprogress/nprogress.css" rel="stylesheet" />
  
  
  
  
  <link href="plugins/DataTables/DataTables-1.10.18/css/jquery.dataTables.min.css" rel="stylesheet" />
  
  
  
  <link href="plugins/jvectormap/jquery-jvectormap-2.0.3.css" rel="stylesheet" />
  
  
  
  <link href="plugins/daterangepicker/daterangepicker.css" rel="stylesheet" />
  
  
  
  <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
  
  
  
  <link href="plugins/toaster/toastr.min.css" rel="stylesheet" />
  
  
  <!-- MONO CSS -->
  <link id="main-css-href" rel="stylesheet" href="css/style.css" />

  


  <!-- FAVICON -->
  <link href="images/favicon.png" rel="shortcut icon" />

  
  <script src="plugins/nprogress/nprogress.js"></script>
  <script src="https://cdn.staticfile.org/jquery/2.2.4/jquery.min.js"></script>
  <script src="js/ie_data.js"></script>
  <!--<script src="js/print.js"></script>-->
</head>


  <body class="navbar-fixed sidebar-fixed" id="body">
    <script>
      NProgress.configure({ showSpinner: false });
      NProgress.start();
    </script>

    
    <!--<div id="toaster"></div>-->
    

    <!-- ====================================
    ——— WRAPPER
    ===================================== -->
       <div class="wrapper">
      
      
        <!-- ====================================
          ——— LEFT SIDEBAR WITH OUT FOOTER
        ===================================== -->
        <aside class="left-sidebar sidebar-dark" id="left-sidebar">
          <div id="sidebar" class="sidebar sidebar-with-footer">
            <!-- Aplication Brand -->
            <div class="app-brand">
              <a href="/index.html">
                <img src="images/main_icon.png" alt="Mono" width="30%">
                <span class="brand-name">多多益善</span>
              </a>
            </div>
            <!-- begin sidebar scrollbar -->
            <div class="sidebar-left" data-simplebar style="height: 100%;">
              <!-- sidebar menu -->
              <ul class="nav sidebar-inner" id="sidebar-menu">
                <li
                class="active"
                >
                
                    <a class="sidenav-item-link" href="index.html">
                      <i class="mdi mdi-briefcase-account-outline"></i>
                      <span class="nav-text">總覽</span>
                    </a>
                  </li>
                

                

                
                  <li
                   >
                    <a class="sidenav-item-link" href="createBill.html">
                      <i class="mdi mdi-chart-line"></i>
                      <span class="nav-text">新增帳單</span>
                    </a>
                  </li>
                  <li>
                    <a class="sidenav-item-link" href="game.html">
                      <i class="mdi mdi-chart-line"></i>
                      <span class="nav-text">新增目標</span>
                    </a>
                  </li>

                

                
            
                

                  <li class="section-title">
                    User
                  </li>
                

                  <li>
                    <a class="sidenav-item-link" href="user-profile-settings.html">
                      <i class="mdi mdi-account-group"></i>
                      <span class="nav-text">個人資料</span>
                    </a>
                  </li>

                          
                        

                        
                      </div>
                    </ul>
                  </li>
                

                

          </div>
        </aside>

      

      <!-- ====================================
      ——— PAGE WRAPPER
      ===================================== -->
      <div class="page-wrapper print-background">
        
          <!-- Header -->
          <header class="main-header" id="header">
            <nav class="navbar navbar-expand-lg navbar-light" id="navbar">
              <!-- Sidebar toggle button -->
              <button id="sidebar-toggler" class="sidebar-toggle">
                <span class="sr-only">Toggle navigation</span>
              </button>

              <span class="page-title">總覽</span>

              <div class="navbar-right ">

  
                  </li>
                </ul>
              </div>
            </nav>


          </header>

        <!-- ====================================
        ——— CONTENT WRAPPER
        ===================================== -->
        <div class="content-wrapper">
          <div class="content" id="html_content">          
                  <!-- Top Statistics -->
                  <div class="row">
                    <div class="col-xl-3 col-sm-6">
                      <div class="card card-default card-mini">
                        <div class="card-header">
                          <h2 id="total_mon_expense"></h2>
                          
                          <div class="sub-title">
                            <span class="mr-1">本月支出</span>
                            <!--<span class="mx-1">45%</span>-->
                            <!--<i class="mdi mdi-arrow-up-bold text-success"></i>-->
                          </div>
                        </div>
                        <div class="card-body">
                          <div class="chart-wrapper">
                            <div>
                              <div id="spline-area-1"></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-xl-3 col-sm-6">
                      <div class="card card-default card-mini">
                        <div class="card-header">
                          <h2 id="total_year_expense"></h2>
                          
                          <div class="sub-title">
                            <span class="mr-1">今年支出</span> 
                            <!--<span class="mx-1">50%</span>-->
                            <!--<i class="mdi mdi-arrow-down-bold text-danger"></i>-->
                          </div>
                        </div>
                        <div class="card-body">
                          <div class="chart-wrapper">
                            <div>
                              <div id="spline-area-2"></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-xl-3 col-sm-6">
                      <div class="card card-default card-mini">
                        <div class="card-header">
                          <h2 id="total_mon_income"></h2>
                          
                          <div class="sub-title">
                            <span class="mr-1">本月收入</span>
                            <!--<span class="mx-1">20%</span>-->
                            <!--<i class="mdi mdi-arrow-down-bold text-danger"></i>-->
                          </div>
                        </div>
                        <div class="card-body">
                          <div class="chart-wrapper">
                            <div>
                              <div id="spline-area-3"></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-xl-3 col-sm-6">
                      <div class="card card-default card-mini">
                        <div class="card-header">
                          <h2 id="total_year_income"></h2>
                          
                          <div class="sub-title">
                            <span class="mr-1">今年收入</span>
                            <!--<span class="mx-1">35%</span>-->
                            <!--<i class="mdi mdi-arrow-up-bold text-success"></i>-->
                          </div>
                        </div>
                        <div class="card-body">
                          <div class="chart-wrapper">
                            <div>
                              <div id="spline-area-4"></div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>


                <div class="row">
                  <div class="col-xl-8">
                    
                    <!-- Income and Express -->
                    <div class="card card-default">
                      <div class="card-header">
                        <h2>支出&收入分析</h2>
                        

                      </div>
                      <div class="card-body">
                        <div class="chart-wrapper">
                          <div id="mixed-chart-1"></div>
                        </div>
                      </div>

                    </div>


                  </div>
                  <div class="col-xl-4">
                    
                    <div class="card card-default">
                      <div class="card-header justify-content-center">
                        <h2>離目標距離</h2>
                      </div>
                      <div class="card-body pt-0">
                        <div class="chart-wrapper">
                          <div id="radial-bar-chart-1"></div>
                        </div>
                        <div class="radial-bar-chart-footer">
                          <div class="title-large" id="revenue"> <!--<i class="mdi mdi-arrow-up text-success"></i>--></div>
                          <div class="title-small" id="goal"></div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>


                
                <!-- Table Product -->
                <div class="row">
                  <div class="col-12">
                    <div class="card card-default">
                      <div class="card-header">
                        <h2>支出</h2>    
                        <div class="dropdown">
                          <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
                            aria-expanded="false"> 支出
                          </a>
                          <div class="dropdown-menu dropdown-menu-right no-print" aria-labelledby="dropdownMenuLink">
                            <a class="dropdown-item" href="index_income.html">收入</a>
                          </div>
                        </div>         
                      </div>
                      <div class="card-body">
                        <div id="productsTable_wrapper" class="dataTables_wrapper no-footer">
                          <div id="productsTable_filter" class="dataTables_filter">
                            <label>
                              <input type="search" id="searchInput" placeholder="Search..." aria-controls="productsTable">
                            </label>
                          </div>
                          <table id="productsTable" class="table table-hover table-product" style="width:100%">
                            <thead>
                              <tr>
                                <th></th>
                                <th>項目名稱</th>
                                <th>類別</th>
                                <th>年</th>
                                <th>月</th>
                                <th>日</th>
                                <th>金額</th>
                                <th></th>
                              </tr>
                            </thead>
                              <tr>
                                <tbody></tbody>
                              </tr>
                          </table>
                        </div>     
                        
                      </div>
                    </div>
                  </div>  
               
              </div>
            <button id="downloadBtn" onclick="window.print()">列印成PDF檔</button>
          </div>
                         
    
                      
        
          <!-- Footer -->
          <footer class="footer mt-auto">
            <div class="copyright bg-white">
              <p>
                &copy; <span id="copy-year"></span> Copyright project by <a class="text-primary" href="http://www.kailun.com/" target="_blank" >Group 8</a>.
              </p>
            </div>
            <script>
                var d = new Date();
                var year = d.getFullYear();
                document.getElementById("copy-year").innerHTML = year;
            </script>
          </footer>

      </div>
    </div>
    
                    <!-- Card Offcanvas -->
                    <div class="card card-offcanvas" id="contact-off" >
                      <div class="card-header">
                        <h2>Contacts</h2>
                        <a href="#" class="btn btn-primary btn-pill px-4">Add New</a>
                      </div>
                      <div class="card-body">

                        <div class="mb-4">
                          <input type="text" class="form-control form-control-lg form-control-secondary rounded-0" placeholder="Search contacts...">
                        </div>

                        <div class="media media-sm">
                          <div class="media-sm-wrapper">
                            <a href="user-profile.html">
                              <img src="images/user/user-sm-01.jpg" alt="User Image">
                              <span class="active bg-primary"></span>
                            </a>
                          </div>
                          <div class="media-body">
                            <a href="user-profile.html">
                              <span class="title">Selena Wagner</span>
                              <span class="discribe">Designer</span>
                            </a>
                          </div>
                        </div>

                        <div class="media media-sm">
                          <div class="media-sm-wrapper">
                            <a href="user-profile.html">
                              <img src="images/user/user-sm-02.jpg" alt="User Image">
                              <span class="active bg-primary"></span>
                            </a>
                          </div>
                          <div class="media-body">
                            <a href="user-profile.html">
                              <span class="title">Walter Reuter</span>
                              <span>Developer</span>
                            </a>
                          </div>
                        </div>

                        <div class="media media-sm">
                          <div class="media-sm-wrapper">
                            <a href="user-profile.html">
                              <img src="images/user/user-sm-03.jpg" alt="User Image">
                            </a>
                          </div>
                          <div class="media-body">
                            <a href="user-profile.html">
                              <span class="title">Larissa Gebhardt</span>
                              <span>Cyber Punk</span>
                            </a>
                          </div>
                        </div>

                        <div class="media media-sm">
                          <div class="media-sm-wrapper">
                            <a href="user-profile.html">
                              <img src="images/user/user-sm-04.jpg" alt="User Image">
                            </a>

                          </div>
                          <div class="media-body">
                            <a href="user-profile.html">
                              <span class="title">Albrecht Straub</span>
                              <span>Photographer</span>
                            </a>
                          </div>
                        </div>

                        <div class="media media-sm">
                          <div class="media-sm-wrapper">
                            <a href="user-profile.html">
                              <img src="images/user/user-sm-05.jpg" alt="User Image">
                              <span class="active bg-danger"></span>
                            </a>
                          </div>
                          <div class="media-body">
                            <a href="user-profile.html">
                              <span class="title">Leopold Ebert</span>
                              <span>Fashion Designer</span>
                            </a>
                          </div>
                        </div>

                        <div class="media media-sm">
                          <div class="media-sm-wrapper">
                            <a href="user-profile.html">
                              <img src="images/user/user-sm-06.jpg" alt="User Image">
                              <span class="active bg-primary"></span>
                            </a>
                          </div>
                          <div class="media-body">
                            <a href="user-profile.html">
                              <span class="title">Selena Wagner</span>
                              <span>Photographer</span>
                            </a>
                          </div>
                        </div>

                      </div>
                    </div>



    
                    <script src="plugins/jquery/jquery.min.js"></script>
                    <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
                    <script src="plugins/simplebar/simplebar.min.js"></script>
                    <script src="https://unpkg.com/hotkeys-js/dist/hotkeys.min.js"></script>

                    
                    
                    <script src="plugins/apexcharts/apexcharts.js"></script>
                    
                    
                    
                    <script src="plugins/DataTables/DataTables-1.10.18/js/jquery.dataTables.min.js"></script>
                    
                    
                    
                    <script src="plugins/jvectormap/jquery-jvectormap-2.0.3.min.js"></script>
                    <script src="plugins/jvectormap/jquery-jvectormap-world-mill.js"></script>
                    <script src="plugins/jvectormap/jquery-jvectormap-us-aea.js"></script>
                    
                    
                    
                    <script src="plugins/daterangepicker/moment.min.js"></script>
                    <script src="plugins/daterangepicker/daterangepicker.js"></script>
                    <script>
                      jQuery(document).ready(function() {
                        jQuery('input[name="dateRange"]').daterangepicker({
                        autoUpdateInput: false,
                        singleDatePicker: true,
                        locale: {
                          cancelLabel: 'Clear'
                        }
                      });
                        jQuery('input[name="dateRange"]').on('apply.daterangepicker', function (ev, picker) {
                          jQuery(this).val(picker.startDate.format('MM/DD/YYYY'));
                        });
                        jQuery('input[name="dateRange"]').on('cancel.daterangepicker', function (ev, picker) {
                          jQuery(this).val('');
                        });
                      });
                    </script>
                    
                    
                    
                    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
                    
                    
                    
                    <script src="plugins/toaster/toastr.min.js"></script>

                    
                    
                    <script src="js/mono.js"></script>
                    <script src="js/chart.js"></script>
                    <script src="js/map.js"></script>
                    <script src="js/custom.js"></script>
                    <!-- import axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios@1.1.2/dist/axios.min.js"></script>
    <!-- Get -->
    <script>          
      //get 帳單        
      async function fetchCItemName(cItems_id) {
        try {
          let response = await axios.get(`https://billapi-6373626296ec.herokuapp.com/cItem/${cItems_id}`);
          return response.data.cItems_name;
        } catch (error) {
          console.error('Error fetching cItem name:', error);
          return ''; // 如果發生錯誤，返回空字符串
        }
      }
      
      async function fetchData() {
        try {
          let response = await axios.get('https://billapi-6373626296ec.herokuapp.com/chargeitem');
          let tbody = document.querySelector('tbody');
          tbody.innerHTML = ''; // 清除先前的表格內容
      
          for (let i = 0; i < response.data.length; i++) {
            let expense = response.data[i];
            let id = expense.charge_item_id;
            let name = expense.charge_name;
            let money = expense.price;
            let year = moment.utc(expense.date).format('YYYY');
            let month = moment.utc(expense.date).format('MM');
            let day = moment.utc(expense.date).format('DD');
      
            let cItems_name = await fetchCItemName(expense.cItems_id);
      
            let item = [id,'', name, cItems_name, year, month, day, money," "];
            let tr = document.createElement('tr');
      
            item.forEach((value, index) => {
              let td = document.createElement('td');
              td.innerHTML = value;
              //隱藏id
              if (index === 0) {
                td.style.display = 'none';
              }
              tr.appendChild(td);
            });
      
            tbody.appendChild(tr);
          }
        } catch (error) {
          console.error('Error fetching data:', error);
        }
      }
      fetchData()
      
      
      // 驗證編輯的所有輸入是否有效的函數
      function validateInputs(tds) {
        for (let j = 2; j < tds.length - 1; j++) {                   
          if(j!=3){                      
            let input=tds[j].querySelector('input').value
            if (!input || input.trim() === '') {
              console.log(input);
              return false; // 如果有空白輸入，返回 false
            }
          }
          if(j==5){
            let input = tds[j].querySelector('input').value;
            let intValue = parseInt(input, 10);

            if (isNaN(intValue) || intValue < 1 || intValue > 12) {
                console.log(input);
                return false; // 如果不在 1 到 12 的範圍內，返回 false
            }
          } 
          if(j==6){
            let input = tds[j].querySelector('input').value;
            let intValue = parseInt(input, 10);

            if (isNaN(intValue) || intValue < 1 || intValue > 31) {
                console.log(input);
                return false; // 如果不在 1 到 31 的範圍內，返回 false
            }
          }                                                                                                                 
          if(j==7){
            let input = tds[j].querySelector('input').value;
            let intValue = parseInt(input, 10);

            if (isNaN(intValue) || intValue <= 0) {
                console.log(input);
                return false; // 如果不是正整數，返回 false
            }
          }                                                                                   
        }                      
        return true; 
      }

      async function initialize() {
        await getSorc(); // 等待 getSorc 完成
        updateExpenseJSON(); // getSorc 完成後再執行 updateExpenseJSON
      }                      
      initialize(); // 調用初始化函數
      //get 類別
      async function getSorc() {
        try {
          let response = await axios.get('https://billapi-6373626296ec.herokuapp.com/cItem');
          let typeList1 = document.getElementById('type_list1');
      
          // 清空現有的選項
          typeList1.innerHTML = '';
      
          // 迭代 sorc_Items 並添加到下拉選單
          response.data.forEach(function (item) {
            let option = document.createElement('option');
            option.value = item.cItems_name;
            option.textContent = item.cItems_name;
            typeList1.appendChild(option);
          });
          typeList1.selectedIndex = 0;
        } catch (error) {
          // 錯誤處理
          console.error('錯誤:', error);
        }
      }                    
      getSorc();
      
    </script>

    <!-- post -->
    
    <script>
      //類別視窗
      let btn=document.querySelector("#show");
      let infoModal=document.querySelector("#infoModal");
      let close=document.querySelector("#close");
      btn.addEventListener("click", function(){
        infoModal.showModal();
      })
      close.addEventListener("click", function(){
        infoModal.close();
      })
      //預設今日
      var today = new Date();
      var dd = String(today.getDate()).padStart(2, '0');
      var mm = String(today.getMonth() + 1).padStart(2, '0');
      var yyyy = today.getFullYear();
      today = yyyy + '-' + mm + '-' + dd;
      document.getElementById("date_picker").value = today;

      //搜尋帳單
      function searchBill(){
        // 獲取 input 元素
        const searchInput = document.getElementById('searchInput');

        // 監聽 input 元素的 input 事件
        searchInput.addEventListener('input', function () {
            // 獲取搜索關鍵詞
            const searchTerm = searchInput.value.toLowerCase();

            // 獲取表格的 tbody 元素
            const tbody = document.querySelector('tbody');

            const rows = tbody.getElementsByTagName('tr');

            for (let i = 0; i < rows.length; i++) {
                const row = rows[i];
                const cells = row.getElementsByTagName('td');

                row.style.display = '';
                console.log(cells[0].innerText)
                // 迭代每一個單元格
                for (let j = 2; j < cells.length; j++) {
                    const cellText = cells[j].textContent || cells[j].innerText;
                
                    // 如果單元格的文本不包含搜索關鍵詞，隱藏該行
                    if (cellText.toLowerCase().indexOf(searchTerm) === -1) {
                      row.style.display = 'none';
                    }else{
                      row.style.display = '';
                      break;
                    }
                }
            }
        });
      }
      searchBill();
    </script>
    
    </script>
                    


                    <!--  -->


  </body>
</html>
